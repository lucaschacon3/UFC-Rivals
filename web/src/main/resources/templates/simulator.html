<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{fragments/head :: head}"></th:block>
    <script th:if="${fighter1 != null and fighter2 != null}" th:inline="javascript">
        /*<![CDATA[*/
        window.addEventListener('load', function () {
            const fighter1Label = /*[[${fighter1.nickname}]]*/ 'Fighter 1';
            const fighter2Label = /*[[${fighter2.nickname}]]*/ 'Fighter 2';

            const radarData = {
                labels: [
                    'Wins KO', 'Wins Sub', 'Wins Dec',
                    'Losses KO', 'Losses Sub', 'Losses Dec',
                    'Draws'
                ],
                datasets: [
                    {
                        label: fighter1Label,
                        data: [
                            /*[[${fighter1.winsKo ?: 0}]]*/,
                            /*[[${fighter1.winsSub ?: 0}]]*/,
                            /*[[${fighter1.winsDec ?: 0}]]*/,
                            /*[[${fighter1.lossesKo ?: 0}]]*/,
                            /*[[${fighter1.lossesSub ?: 0}]]*/,
                            /*[[${fighter1.lossesDec ?: 0}]]*/,
                            /*[[${fighter1.totalDraws ?: 0}]]*/
                        ],
                        backgroundColor: 'rgba(229, 15, 15, 0.2)',
                        borderColor: 'rgba(229, 15, 15, 1)',
                        borderWidth: 2
                    },
                    {
                        label: fighter2Label,
                        data: [
                            /*[[${fighter2.winsKo ?: 0}]]*/,
                            /*[[${fighter2.winsSub ?: 0}]]*/,
                            /*[[${fighter2.winsDec ?: 0}]]*/,
                            /*[[${fighter2.lossesKo ?: 0}]]*/,
                            /*[[${fighter2.lossesSub ?: 0}]]*/,
                            /*[[${fighter2.lossesDec ?: 0}]]*/,
                            /*[[${fighter2.totalDraws ?: 0}]]*/
                        ],
                        backgroundColor: 'rgba(8, 62, 124, 0.2)',
                        borderColor: 'rgb(15,117,227)',
                        borderWidth: 2
                    }
                ]
            };

            const config = {
                type: 'radar',
                data: radarData,
                options: {
                    responsive: true,
                    scales: {
                        r: {
                            beginAtZero: true,
                            suggestedMax: 12
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    }
                }
            };

            new Chart(document.getElementById('fighterRadarChart'), config);

        });
        /*]]>*/

        setTimeout(() => {
            Swal.fire({
                title: 'Save this fight?',
                text: 'Would you like to save this fight for later?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#E50F0F',
                cancelButtonColor: '#96979a',
                confirmButtonText: 'Yes, save it!',
                cancelButtonText: 'No, thanks',
                customClass: {
                    popup: 'rounded-2xl',
                    title: 'text-lg ',
                    confirmButton: 'px-4 py-2',
                    cancelButton: 'px-4 py-2',
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Saved!',
                        text: 'This fight has been saved.',
                        confirmButtonColor: '#E50F0F'
                    });

                    // la lógica real de guardar
                }
            });
        }, 5000);

    </script>



</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>
<!--<div th:replace="~{fragments/preloader :: preloader}"></div>-->


<div class="min-h-screen flex flex-col items-center justify-start px-4 py-8">

    <!-- Formulario de selección -->
    <form method="get" action="#" class="flex flex-col md:flex-row justify-between items-center gap-4 mb-6">
        <!-- Select para categorías -->

        <select name="category"
                class="px-4 pr-8 py-2 border w-full md:w-1/4 h-12 truncate whitespace-nowrap"
                onchange="this.form.submit()">
            <option value="" disabled selected th:text="${category_selected}">select category</option>
            <option th:value="${'Flyweight'}">Flyweight</option>
            <option th:value="${'Bantamweight'}">Bantamweight</option>
            <option th:value="${'Featherweight'}">Featherweight</option>
            <option th:value="${'Lightweight'}">Lightweight</option>
            <option th:value="${'Welterweight'}">Welterweight</option>
            <option th:value="${'Middleweight'}">Middleweight</option>
            <option th:value="${'Light Heavyweight'}">Light Heavyweight</option>
            <option th:value="${'Heavyweight'}">Heavyweight</option>
        </select>


        <!-- Select para peleador 1 -->
        <select name="fighter1Id"
                class="px-4 pr-8 py-2 border w-full md:w-1/4 h-12 truncate whitespace-nowrap"
                required>
            <option value="" disabled selected>select fighter</option>
            <option th:each="fighter : ${fighters}"
                    th:value="${fighter.idFighter}"
                    th:text="|${fighter.name} ${fighter.surname}|"></option>
        </select>

        <!-- Select para peleador 2 -->
        <select name="fighter2Id"
                class="px-4 pr-8 py-2 border w-full md:w-1/4 h-12 truncate whitespace-nowrap"
                required>
            <option value="" disabled selected>select fighter</option>
            <option th:each="fighter : ${fighters}"
                    th:value="${fighter.idFighter}"
                    th:text="|${fighter.name} ${fighter.surname}|"></option>
        </select>

        <!-- Botón de comparar -->
        <button type="submit"
                class="w-full md:w-1/4 h-12 bg-[#E50F0F] hover:bg-red-700 text-white px-4 py-2">
            fight
        </button>
    </form>


    <!-- Comparación de peleadores -->
    <div th:if="${fighter1 != null && fighter2 != null}" class="bg-white p-6 shadow-xl w-full max-w-6xl">
        <h2 class="text-2xl mb-6 text-center">Fighter Comparison</h2>

        <div class="flex flex-col md:flex-row gap-8">
            <!-- Fighter 1 -->
            <div class="w-full md:w-1/2 text-center border-2 border-gray p-4">
                <img th:src="@{${fighter1.image}}" alt="Fighter 1 Image"
                     class="w-48 h-70 object-cover mb-4 mx-auto block"/>
                <h3 class="text-xl" th:text="${fighter1.nickname}"></h3>
                <p th:text="${fighter1.name + ' ' + fighter1.surname}"></p>
                <p th:text="'Weight: ' + ${fighter1.weight} + ' lbs'"></p>
            </div>

            <div class="flex items-center justify-center">
                <h1 class="text-[#E50F0F] text-center text-4xl">VS</h1>
            </div>

            <!-- Fighter 2 -->
            <div class="w-full md:w-1/2 text-center border-2 border-gray p-4">
                <img th:src="@{${fighter2.image}}" alt="Fighter 1 Image"
                     class="w-48 h-70 object-cover mb-4 mx-auto block"/>
                <h3 class="text-xl" th:text="${fighter2.nickname}"></h3>
                <p th:text="${fighter2.name + ' ' + fighter2.surname}"></p>
                <p th:text="'Weight: ' + ${fighter2.weight} + ' lbs'"></p>
            </div>

        </div>

        <!-- Comparison Table -->
        <div class="mt-8">
            <table class="w-full text-center table-fixed border-collapse">
                <thead>
                <tr class="bg-gray-100">
                    <th class="py-2 font-normal">Attribute</th>
                    <th class="py-2 font-normal text-[#E50F0F]" th:text="${fighter1.name} + ' ' + ${fighter1.surname}"></th>
                    <th class="py-2 font-normal text-blue-500" th:text="${fighter2.name} + ' ' + ${fighter2.surname}"></th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>Age</td>
                    <td th:class="${fighter1.age < fighter2.age ? 'text-[#00cc66]' : ''}"
                        th:text="${fighter1.age}"></td>
                    <td th:class="${fighter2.age < fighter1.age ? 'text-[#00cc66]' : ''}"
                        th:text="${fighter2.age}"></td>
                </tr>
                <tr>
                    <td>Height</td>
                    <td th:class="${fighter1.height > fighter2.height ? 'text-[#00cc66]' : ''}"
                        th:text="${fighter1.height + ' m'}"></td>
                    <td th:class="${fighter2.height > fighter1.height ? 'text-[#00cc66]' : ''}"
                        th:text="${fighter2.height + ' m'}"></td>
                </tr>
                <tr>
                    <td>Reach</td>
                    <td th:class="${fighter1.reach > fighter2.reach ? 'text-[#00cc66]' : ''}"
                        th:text="${fighter1.reach + ' in'}"></td>
                    <td th:class="${fighter2.reach > fighter1.reach ? 'text-[#00cc66]' : ''}"
                        th:text="${fighter2.reach + ' in'}"></td>
                </tr>
                <tr>
                    <td>Total Fights</td>
                    <td th:class="${fighter1.totalFights > fighter2.totalFights ? 'text-[#00cc66]' : ''}"
                        th:text="${fighter1.totalFights}"></td>
                    <td th:class="${fighter2.totalFights > fighter1.totalFights ? 'text-[#00cc66]' : ''}"
                        th:text="${fighter2.totalFights}"></td>
                </tr>
                <tr>
                    <td>Wins</td>
                    <td th:class="${fighter1.totalWins > fighter2.totalWins ? 'text-[#00cc66]' : ''}"
                        th:text="${fighter1.totalWins}"></td>
                    <td th:class="${fighter2.totalWins > fighter1.totalWins ? 'text-[#00cc66]' : ''}"
                        th:text="${fighter2.totalWins}"></td>
                </tr>
                <tr>
                    <td>Losses</td>
                    <td th:class="${fighter1.totalLosses < fighter2.totalLosses ? 'text-[#00cc66]' : ''}"
                        th:text="${fighter1.totalLosses}"></td>
                    <td th:class="${fighter2.totalLosses < fighter1.totalLosses ? 'text-[#00cc66]' : ''}"
                        th:text="${fighter2.totalLosses}"></td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="w-full max-w-xl mx-auto mt-10" th:if="${fighter1 != null and fighter2 != null}">
            <canvas id="fighterRadarChart"></canvas>
        </div>





        <!-- Win Probability Bar -->
        <div class="mt-8 text-center" th:if="${fighter1.totalFights > 0 and fighter2.totalFights > 0}">
            <h3 class="text-xl mb-2">Estimated Win Probability</h3>

            <th:block th:with="p1Score=${fighter1.totalWins * 1.0},
            p2Score=${fighter2.totalWins * 1.0},
            total=${p1Score + p2Score},
            percent1=${total > 0 ? (p1Score * 100 / total) : 50},
            percent2=${100 - percent1}">

                <div class="w-full bg-gray-300 h-6 rounded-full overflow-hidden flex">
                    <div class="bg-[#E50F0F] h-full text-white text-sm flex items-center justify-center"
                         th:style="'width:' + ${percent1} + '%'">
                        <span th:text="${#numbers.formatDecimal(percent1, 0, 0)} + '%'"></span>
                    </div>
                    <div class="bg-blue-500 h-full text-white text-sm flex items-center justify-center"
                         th:style="'width:' + ${percent2} + '%'">
                        <span th:text="${#numbers.formatDecimal(percent2, 0, 0)} + '%'"></span>
                    </div>
                </div>

                <p class="mt-2">
                    <span th:text="${fighter1.name} + ' ' + ${fighter1.surname}"></span> vs
                    <span th:text="${fighter2.name} + ' ' + ${fighter2.surname}"></span>
                </p>
            </th:block>
        </div>

    </div>
    <!--Modal-->
    <div id="customConfirmModal" class="custom-modal-overlay hidden">
        <div class="custom-modal">
            <p class="text-lg font-medium mb-4">Would you like to save this fight?</p>
            <div>
                <button class="confirm-btn" id="confirmSaveBtn">Save</button>
                <button class="cancel-btn" id="cancelSaveBtn">Cancel</button>
            </div>
        </div>
    </div>



</div>
</div>

<div th:replace="~{fragments/footer :: footer}"></div>
</body>
</html>
